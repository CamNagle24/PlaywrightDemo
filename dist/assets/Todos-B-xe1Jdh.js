import{r as x,y as m,C as G,d as l,f as o,p as C,k as v,z as g,u,D as b,E as h,F as B,h as I,l as w,G as S,R as T,H as N,I as A,n,j as P}from"./vue-vendor-CovbRsIb.js";import{u as X,d as i,b as M}from"./index-CPPVuLON.js";import{X as Y,Y as Z,Z as y,$ as D,a0 as $,a1 as J,a2 as K,a3 as O}from"./firebase-BFELHJ2J.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";const W={class:"card"},ee={class:"title"},te={key:0,class:"badge"},se={key:0,class:"hint"},oe={key:1},ae={key:0,class:"categories"},ne={class:"manage"},le={class:"cat-list"},re=["onClick"],ue={key:0,class:"empty"},ie={class:"todo-list"},de={class:"todo-main"},ce={key:0,class:"category"},me=["onClick"],ve={key:0,class:"empty"},ge={__name:"Todos",setup(ye){const a=X(),E=G(),p=x(""),f=x(""),c=x(""),r=m(()=>{const s=E.params.category;return!s||typeof s!="string"?"":decodeURIComponent(s)}),F=m(()=>a.value?Y(y(i,"users",a.value.uid,"todos"),Z("done","==",!1)):null),U=M(F),k=m(()=>{if(!U.value)return[];let s=U.value;return r.value&&(s=s.filter(t=>t.category===r.value)),[...s].sort((t,e)=>{const _=t.createdAt?t.createdAt.toMillis():0;return(e.createdAt?e.createdAt.toMillis():0)-_})}),z=m(()=>a.value?y(i,"users",a.value.uid,"categories"):null),d=M(z),V=m(()=>(d.value||[]).map(s=>s.name).filter(Boolean));async function H(){if(!a.value)return;const s=p.value.trim(),t=f.value.trim();if(!s)return;const e=t||r.value||null;e&&((d.value||[]).some(R=>R.name===e)||await D(y(i,"users",a.value.uid,"categories"),{name:e})),await D(y(i,"users",a.value.uid,"todos"),{text:s,done:!1,category:e,createdAt:O()}),p.value="",f.value=""}async function L(s){if(!a.value)return;const t=$(i,"users",a.value.uid,"todos",s.id);await K(t,{done:!0})}async function j(){if(!a.value)return;const s=c.value.trim();if(!s)return;if((d.value||[]).some(e=>e.name===s)){console.log("Category already exists:",s),c.value="";return}try{console.log("Adding category:",s),await D(y(i,"users",a.value.uid,"categories"),{name:s}),console.log("Category added successfully!")}catch(e){console.error("Error adding category:",e)}c.value=""}async function q(s){if(!a.value)return;const t=$(i,"users",a.value.uid,"categories",s.id);await J(t)}return(s,t)=>(n(),l("div",W,[o("h1",ee,[t[3]||(t[3]=C(" To-Do ",-1)),r.value?(n(),l("span",te,g(r.value),1)):v("",!0)]),u(a)?(n(),l("div",oe,[o("form",{class:"new-todo",onSubmit:B(H,["prevent"])},[b(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>p.value=e),placeholder:"New to-do..."},null,512),[[h,p.value]]),b(o("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>f.value=e),placeholder:"Category (optional)..."},null,512),[[h,f.value]]),t[4]||(t[4]=o("button",{type:"submit"},"Add",-1))],32),V.value.length?(n(),l("div",ae,[t[6]||(t[6]=o("span",{class:"cat-label"},"Filter:",-1)),I(u(T),{to:"/todos",class:S(["chip",{active:!r.value}])},{default:w(()=>[...t[5]||(t[5]=[C(" All ",-1)])]),_:1},8,["class"]),(n(!0),l(N,null,A(V.value,e=>(n(),P(u(T),{key:e,to:`/todos/${encodeURIComponent(e)}`,class:S(["chip",{active:r.value===e}])},{default:w(()=>[C(g(e),1)]),_:2},1032,["to","class"]))),128))])):v("",!0),o("div",ne,[t[8]||(t[8]=o("h2",{class:"manage-title"},"Categories",-1)),o("form",{class:"cat-form",onSubmit:B(j,["prevent"])},[b(o("input",{"onUpdate:modelValue":t[2]||(t[2]=e=>c.value=e),placeholder:"New category name..."},null,512),[[h,c.value]]),t[7]||(t[7]=o("button",{type:"submit"},"Add category",-1))],32),o("ul",le,[(n(!0),l(N,null,A(u(d),e=>(n(),l("li",{key:e.id},[o("span",null,g(e.name),1),o("button",{class:"x-btn",onClick:_=>q(e)},"âœ•",8,re)]))),128)),u(d)&&u(d).length===0?(n(),l("li",ue," No categories yet. ")):v("",!0)])]),o("ul",ie,[(n(!0),l(N,null,A(k.value,e=>(n(),l("li",{key:e.id},[o("div",de,[I(u(T),{to:{name:"todo-id",params:{TodoId:e.id}},class:"todo-text"},{default:w(()=>[C(g(e.text&&e.text.length>100?e.text.substring(0,100)+"...":e.text||"(no text)"),1)]),_:2},1032,["to"]),e.category?(n(),l("span",ce,g(e.category),1)):v("",!0)]),o("button",{class:"small-btn",onClick:_=>L(e)},"Done",8,me)]))),128)),k.value&&k.value.length===0?(n(),l("li",ve," No active to-dos yet. ")):v("",!0)])])):(n(),l("p",se," Please go back and sign in on the Home page to see your to-dos. "))]))}},ke=Q(ge,[["__scopeId","data-v-d40138e1"]]);export{ke as default};
